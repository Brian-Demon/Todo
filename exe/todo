#!/usr/bin/env ruby

require "thor"
require "bundler/setup"
require "todo"

class TodoCLI < Thor
  desc("add [ITEM]", "adds item to list")
  option :database, default: "~/.todo"
  def add(item)
    config = {
      database: File.open(File.expand_path(options[:database]), "a+")
    }
    manager = Todo::Manager.new(config)
    if manager.item_already_added?(item)
      response = ask("\"#{item}\" is already in the list. Add it again? [y/n]:".to_s)
      return if response.downcase != "y"
    end
    manager.add(item)
    puts "\"#{item}\" added"
  end #add

  desc("display", "displays the current todo list")
  option :database, default: "~/.todo"
  def display
    config = {
      database: File.open(File.expand_path(options[:database]), "a+")
    }
    puts "\n#{Todo::Manager.new(config).display}\n"
  end #display

  desc("remove", "removes item from list based on list number")
  option :database, default: "~/.todo"
  def remove
    config = {
      database: File.open(File.expand_path(options[:database]), "a+")
    }
    manager = Todo::Manager.new(config)
    puts "\n\n#{manager.display}"
    response = ask("Item to remove (#): ")
    if !manager.valid_removal?(response)
      puts "\n\"#{response}\" is not a valid input\n\n"
    end
    puts "\n\n#{manager.get_contents.length}\n\n"
  end #remove
end #TodoCLI

TodoCLI.start(ARGV)
